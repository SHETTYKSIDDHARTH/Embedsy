"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("react/jsx-runtime"),d=require("react");function F({onClick:o,themeColor:t="#00FF87"}){const[n,s]=d.useState(!1);return e.jsx("button",{onClick:o,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),"aria-label":"Open chat",style:{width:"60px",height:"60px",borderRadius:"50%",background:t,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:n?"0 8px 32px rgba(0,0,0,0.4)":"0 4px 20px rgba(0,0,0,0.3)",transform:n?"scale(1.1)":"scale(1)",transition:"all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1)",color:"#000",outline:"none",padding:"0",flexShrink:"0"},children:e.jsx("svg",{width:"26",height:"26",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})}const b=[{code:"en",label:"EN",name:"English"},{code:"hi",label:"HI",name:"Hindi"},{code:"es",label:"ES",name:"Spanish"},{code:"fr",label:"FR",name:"French"},{code:"de",label:"DE",name:"German"},{code:"pt",label:"PT",name:"Portuguese"},{code:"it",label:"IT",name:"Italian"},{code:"ar",label:"AR",name:"Arabic"},{code:"zh",label:"ZH",name:"Chinese"},{code:"ja",label:"JA",name:"Japanese"},{code:"ko",label:"KO",name:"Korean"}];function R({onClose:o,title:t="Chat with us",themeColor:n="#00FF87",selectedLanguage:s,onLanguageChange:a}){const[r,l]=d.useState(!1),i=b.find(p=>p.code===s)||b[0];n==="#ffffff"||n==="#fff"||n.toLowerCase();const c="#000000";return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 16px",background:n,flexShrink:"0",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#000",opacity:.4,boxShadow:"0 0 0 2px rgba(0,0,0,0.15)"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"700",color:c,margin:0},children:t})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{onClick:()=>l(!r),style:{display:"flex",alignItems:"center",gap:"3px",background:"rgba(0,0,0,0.15)",border:"1px solid rgba(0,0,0,0.1)",borderRadius:"6px",padding:"4px 8px",fontSize:"11px",fontWeight:"700",color:c,cursor:"pointer",letterSpacing:"0.5px",transition:"background 0.2s",outline:"none"},children:[i.label,e.jsx("svg",{width:"10",height:"10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{transform:r?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})]}),r&&e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",right:"0",background:"#111",border:"1px solid #2a2a2a",borderRadius:"12px",overflow:"hidden",zIndex:"10000001",minWidth:"150px",boxShadow:"0 12px 32px rgba(0,0,0,0.6)"},children:b.map(p=>e.jsxs("button",{onClick:()=>{a(p.code),l(!1)},style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"9px 14px",background:p.code===s?"rgba(255,255,255,0.06)":"transparent",border:"none",cursor:"pointer",transition:"background 0.15s",textAlign:"left",outline:"none"},children:[e.jsx("span",{style:{fontSize:"11px",fontWeight:"700",color:n,minWidth:"26px",letterSpacing:"0.5px"},children:p.label}),e.jsx("span",{style:{fontSize:"12px",color:"#ccc"},children:p.name})]},p.code))})]}),e.jsx("button",{onClick:o,"aria-label":"Close chat",style:{background:"rgba(0,0,0,0.15)",border:"none",borderRadius:"6px",padding:"5px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:c,transition:"background 0.2s",outline:"none"},children:e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})})]})]})}const C=o=>{const t=new Date,n=new Date(o),s=Math.floor((t-n)/6e4);if(s<1)return"Just now";if(s<60)return`${s}m ago`;const a=Math.floor(s/60);return a<24?`${a}h ago`:n.toLocaleDateString()};function D({message:o,themeColor:t="#00FF87"}){const{role:n,content:s,timestamp:a,sources:r,confidence:l}=o,i=n==="user";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",maxWidth:"85%",alignSelf:i?"flex-end":"flex-start",alignItems:i?"flex-end":"flex-start"},children:[e.jsx("div",{style:{padding:"10px 14px",borderRadius:i?"14px 14px 4px 14px":"14px 14px 14px 4px",fontSize:"13px",lineHeight:"1.6",wordBreak:"break-word",background:i?t:"#1e1e1e",color:i?"#000":"#e8e8e8",border:i?"none":"1px solid #2a2a2a",boxShadow:"0 1px 4px rgba(0,0,0,0.2)"},children:s}),r&&r.length>0&&e.jsxs("div",{style:{fontSize:"11px",color:"#555",marginTop:"4px",padding:"0 4px"},children:["Based on ",r.length," source",r.length>1?"s":""]}),e.jsx("div",{style:{fontSize:"10px",color:"#444",marginTop:"3px",padding:"0 4px"},children:C(a)})]})}function L(){return e.jsxs("div",{style:{alignSelf:"flex-start",display:"flex",alignItems:"center",gap:"4px",padding:"12px 16px",background:"#1e1e1e",border:"1px solid #2a2a2a",borderRadius:"14px 14px 14px 4px",boxShadow:"0 1px 4px rgba(0,0,0,0.2)"},children:[[0,1,2].map(o=>e.jsx("div",{style:{width:"6px",height:"6px",background:"#555",borderRadius:"50%",animation:`embedsy-bounce 1.2s ease-in-out ${o*.2}s infinite`}},o)),e.jsx("style",{children:`
        @keyframes embedsy-bounce {
          0%, 60%, 100% { transform: translateY(0); }
          30% { transform: translateY(-5px); }
        }
      `})]})}function A({error:o,onRetry:t}){return o?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",padding:"10px 14px",background:"rgba(255, 71, 87, 0.08)",border:"1px solid rgba(255, 71, 87, 0.25)",borderRadius:"10px",fontSize:"12px",color:"#ff6b7a",alignSelf:"stretch"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"700",marginBottom:"2px"},children:"âš ï¸ Something went wrong"}),e.jsx("div",{style:{opacity:.8},children:o})]}),t&&e.jsx("button",{onClick:t,style:{background:"rgba(255, 71, 87, 0.15)",border:"1px solid rgba(255, 71, 87, 0.3)",borderRadius:"6px",padding:"5px 12px",fontSize:"11px",fontWeight:"600",color:"#ff6b7a",cursor:"pointer",whiteSpace:"nowrap",outline:"none",flexShrink:0},children:"Retry"})]}):null}function z({messages:o,isLoading:t,error:n,onRetry:s,themeColor:a}){const r=d.useRef(null);return d.useEffect(()=>{r.current&&r.current.scrollIntoView({behavior:"smooth",block:"end"})},[o,t]),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 12px",display:"flex",flexDirection:"column",gap:"10px",scrollbarWidth:"thin",scrollbarColor:"#333 transparent"},children:[o.map(l=>e.jsx(D,{message:l,themeColor:a},l.id)),t&&e.jsx(L,{}),n&&e.jsx(A,{error:n,onRetry:s}),e.jsx("div",{ref:r})]})}function O({onClick:o,disabled:t,themeColor:n="#00FF87"}){const[s,a]=d.useState(!1);return e.jsx("button",{onClick:o,disabled:t,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),"aria-label":"Send message",style:{width:"38px",height:"38px",borderRadius:"10px",background:n,border:"none",cursor:t?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#000",opacity:t?.3:s?.9:1,transform:s&&!t?"scale(1.05)":"scale(1)",transition:"all 0.15s ease",flexShrink:0,outline:"none",padding:"0"},children:e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})}function W({onSend:o,disabled:t,themeColor:n="#00FF87"}){const[s,a]=d.useState(""),[r,l]=d.useState(!1),i=d.useRef(null);d.useEffect(()=>{!t&&i.current&&i.current.focus()},[t]);const c=()=>{s.trim()&&!t&&(o(s.trim()),a(""),i.current&&i.current.focus())},p=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),c())};return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",borderTop:"1px solid #1e1e1e",background:"#0f0f0f",flexShrink:0},children:[e.jsx("input",{ref:i,type:"text",placeholder:"Ask something...",value:s,onChange:u=>a(u.target.value),onKeyDown:p,onFocus:()=>l(!0),onBlur:()=>l(!1),disabled:t,maxLength:2e3,style:{flex:1,background:"#1a1a1a",border:`1px solid ${r?n:"#2a2a2a"}`,borderRadius:"10px",padding:"10px 14px",fontSize:"13px",color:"#e8e8e8",outline:"none",transition:"border-color 0.2s",fontFamily:"inherit",opacity:t?.5:1,cursor:t?"not-allowed":"text",boxSizing:"border-box"}}),e.jsx(O,{onClick:c,disabled:t||!s.trim(),themeColor:n})]})}function T({messages:o,isLoading:t,error:n,onSend:s,onClose:a,onRetry:r,title:l,themeColor:i,selectedLanguage:c,onLanguageChange:p}){return e.jsxs("div",{style:{width:"360px",height:"520px",background:"#0f0f0f",borderRadius:"16px",border:"1px solid #222",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.04)",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"},children:[e.jsx(R,{onClose:a,title:l,themeColor:i,selectedLanguage:c,onLanguageChange:p}),e.jsx(z,{messages:o,isLoading:t,error:n,onRetry:r,themeColor:i}),e.jsx(W,{onSend:s,disabled:t,themeColor:i}),e.jsxs("div",{style:{textAlign:"center",fontSize:"10px",color:"#333",padding:"6px",background:"#0a0a0a",flexShrink:0},children:["Powered by"," ",e.jsx("a",{href:"https://embedsy.dev",target:"_blank",rel:"noopener noreferrer",style:{color:i,textDecoration:"none"},children:"Embedsy"})]})]})}const S="embedsy_messages",B=(o,t)=>{try{const n=`${S}_${o}`;localStorage.setItem(n,JSON.stringify({messages:t,timestamp:new Date().toISOString()}))}catch(n){console.warn("Embedsy: Failed to save messages:",n)}},$=o=>{try{const t=`${S}_${o}`,n=localStorage.getItem(t);if(!n)return[];const s=JSON.parse(n),a=Date.now()-new Date(s.timestamp).getTime(),r=24*60*60*1e3;return a>r?(localStorage.removeItem(t),[]):s.messages||[]}catch(t){return console.warn("Embedsy: Failed to load messages:",t),[]}},_=o=>{const[t,n]=d.useState([]);return d.useEffect(()=>{if(o){const r=$(o);r.length>0?n(r):n([{id:`msg_${Date.now()}`,role:"bot",content:"ðŸ‘‹ Hi there! I'm your AI assistant. Ask me anything about our documentation and I'll help you find the answers!",timestamp:new Date().toISOString()}])}},[o]),d.useEffect(()=>{o&&t.length>0&&B(o,t)},[t,o]),{messages:t,addMessage:r=>{n(l=>[...l,{...r,id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:r.timestamp||new Date().toISOString()}])},clearAllMessages:()=>{n([{id:`msg_${Date.now()}`,role:"bot",content:"ðŸ‘‹ Hi there! I'm your AI assistant. Ask me anything about our documentation and I'll help you find the answers!",timestamp:new Date().toISOString()}])}}},H=async(o,t,n,s="en",a)=>{try{const r=await fetch(`${a}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:o,message:t,apiKey:n,targetLanguage:s})});if(!r.ok){const l=await r.json();throw new Error(l.error||"Failed to get response from server")}return await r.json()}catch(r){throw r.name==="TypeError"?new Error("No response from server. Please check your connection."):r}},N=(o,t,n,s,a)=>{const[r,l]=d.useState(!1),[i,c]=d.useState(null);return{send:async g=>{if(!(!g.trim()||r)){l(!0),c(null);try{const f=await H(o,g,t,n,a);return s&&s(f),f}catch(f){throw c(f.message),f}finally{l(!1)}}},isLoading:r,error:i,clearError:()=>c(null)}},P="https://embedsy-backend.onrender.com/api";function U({projectId:o,apiKey:t,title:n="Chat with us",position:s="bottom-right",themeColor:a="#00FF87",apiUrl:r=P}){const[l,i]=d.useState(!1),[c,p]=d.useState("en"),{messages:u,addMessage:g,clearAllMessages:f}=_(o),w=x=>{g({role:"bot",content:x.answer,sources:x.sources,confidence:x.confidence})},{send:m,isLoading:k,error:j,clearError:y}=N(o,t,c,w,r),v=async x=>{g({role:"user",content:x}),y();try{await m(x)}catch(h){console.error("Embedsy: Failed to send message:",h)}},I=()=>{const x=[...u].reverse().find(h=>h.role==="user");x&&(y(),m(x.content))},M=x=>{p(x),f()},E=s==="bottom-left"?{bottom:"24px",left:"24px"}:{bottom:"24px",right:"24px"};return e.jsx("div",{style:{position:"fixed",zIndex:999999,fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",...E},children:l?e.jsx(T,{messages:u,isLoading:k,error:j,onSend:v,onClose:()=>i(!1),onRetry:I,onClear:f,title:n,themeColor:a,selectedLanguage:c,onLanguageChange:M}):e.jsx(F,{onClick:()=>i(!0),themeColor:a})})}exports.EmbedsynWidget=U;
