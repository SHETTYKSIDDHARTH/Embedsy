"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("react/jsx-runtime"),l=require("react");function C({onClick:s,unreadCount:t=0}){return e.jsxs("button",{className:"embedsy-chat-bubble",onClick:s,"aria-label":"Open chat",title:"Open chat",children:[e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),t>0&&e.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",background:"#FF4757",color:"#FFFFFF",borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"700",border:"2px solid #0A0A0A"},children:t})]})}const y=[{code:"en",label:"EN",name:"English"},{code:"hi",label:"HI",name:"Hindi"},{code:"es",label:"ES",name:"Spanish"},{code:"fr",label:"FR",name:"French"},{code:"de",label:"DE",name:"German"},{code:"pt",label:"PT",name:"Portuguese"},{code:"it",label:"IT",name:"Italian"},{code:"ar",label:"AR",name:"Arabic"},{code:"zh",label:"ZH",name:"Chinese"},{code:"ja",label:"JA",name:"Japanese"},{code:"ko",label:"KO",name:"Korean"}];function F({onClose:s,title:t="Chat with us",selectedLanguage:o,onLanguageChange:a}){const[r,n]=l.useState(!1),i=y.find(c=>c.code===o)||y[0];return e.jsxs("div",{className:"embedsy-chat-header",children:[e.jsx("h3",{children:t}),e.jsxs("div",{className:"embedsy-header-actions",children:[e.jsxs("div",{className:"embedsy-lang-selector",children:[e.jsxs("button",{className:"embedsy-lang-btn",onClick:()=>n(!r),title:"Select language",children:[i.label,e.jsx("svg",{className:`embedsy-lang-chevron ${r?"open":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})]}),r&&e.jsx("div",{className:"embedsy-lang-dropdown",children:y.map(c=>e.jsxs("button",{className:`embedsy-lang-option ${c.code===o?"active":""}`,onClick:()=>{a(c.code),n(!1)},children:[e.jsx("span",{className:"embedsy-lang-option-code",children:c.label}),e.jsx("span",{className:"embedsy-lang-option-name",children:c.name})]},c.code))})]}),e.jsx("button",{className:"embedsy-close-btn",onClick:s,"aria-label":"Close chat",title:"Close chat",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})})]})]})}const I=s=>{const t=new Date,o=new Date(s),a=Math.floor((t-o)/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const r=Math.floor(a/60);return r<24?`${r}h ago`:o.toLocaleDateString()},b=s=>s>=80?{text:"High",color:"#00FF87"}:s>=60?{text:"Medium",color:"#FFA502"}:{text:"Low",color:"#FF4757"};function L({sources:s}){return!s||s.length===0?null:e.jsxs("div",{className:"embedsy-source-citation",children:["Based on ",s.length," source",s.length>1?"s":""," from documentation"]})}function A({message:s}){const{role:t,content:o,timestamp:a,sources:r,confidence:n}=s;return e.jsxs("div",{className:`embedsy-message ${t}`,children:[e.jsxs("div",{className:"embedsy-message-bubble",children:[o,n&&n>0&&e.jsx("span",{className:"embedsy-confidence-badge",style:{background:`${b(n).color}25`,color:b(n).color,borderColor:`${b(n).color}50`},children:b(n).text})]}),r&&r.length>0&&e.jsx(L,{sources:r}),e.jsx("div",{className:"embedsy-message-time",children:I(a)})]})}function D(){return e.jsx("div",{className:"embedsy-message bot",children:e.jsxs("div",{className:"embedsy-typing-indicator",children:[e.jsx("div",{className:"embedsy-typing-dot"}),e.jsx("div",{className:"embedsy-typing-dot"}),e.jsx("div",{className:"embedsy-typing-dot"})]})})}function O({error:s,onRetry:t}){return s?e.jsxs("div",{className:"embedsy-error-message",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âš ï¸ Oops!"}),e.jsx("div",{children:s})]}),t&&e.jsx("button",{onClick:t,className:"embedsy-retry-btn",children:"Retry"})]}):null}function $({messages:s,isLoading:t,error:o,onRetry:a}){const r=l.useRef(null),n=l.useRef(null),i=()=>{r.current&&r.current.scrollIntoView({behavior:"smooth",block:"end"})};return l.useEffect(()=>{i()},[s,t]),e.jsxs("div",{className:"embedsy-messages-container",ref:n,children:[s.map(c=>e.jsx(A,{message:c},c.id)),t&&e.jsx(D,{}),o&&e.jsx(O,{error:o,onRetry:a}),e.jsx("div",{ref:r})]})}function R({onClick:s,disabled:t}){return e.jsx("button",{className:"embedsy-send-btn",onClick:s,disabled:t,"aria-label":"Send message",title:"Send message",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})}function T({onSend:s,disabled:t}){const[o,a]=l.useState(""),r=l.useRef(null);l.useEffect(()=>{!t&&r.current&&r.current.focus()},[t]);const n=()=>{o.trim()&&!t&&(s(o.trim()),a(""),r.current&&r.current.focus())},i=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),n())};return e.jsxs("div",{className:"embedsy-input-container",children:[e.jsx("input",{ref:r,type:"text",className:"embedsy-input",placeholder:"Type your question here...",value:o,onChange:c=>a(c.target.value),onKeyDown:i,disabled:t,maxLength:2e3}),e.jsx(R,{onClick:n,disabled:t||!o.trim()})]})}function _({messages:s,isLoading:t,error:o,onSend:a,onClose:r,onRetry:n,title:i,selectedLanguage:c,onLanguageChange:m}){return e.jsxs("div",{className:"embedsy-chat-window",children:[e.jsx(F,{onClose:r,title:i,selectedLanguage:c,onLanguageChange:m}),e.jsx($,{messages:s,isLoading:t,error:o,onRetry:n}),e.jsx(T,{onSend:a,disabled:t}),e.jsxs("div",{className:"embedsy-powered-by",children:["Powered by ",e.jsx("a",{href:"https://embedsy.dev",target:"_blank",rel:"noopener noreferrer",children:"Embedsy"})]})]})}const w="embedsy_messages",B=(s,t)=>{try{const o=`${w}_${s}`;localStorage.setItem(o,JSON.stringify({messages:t,timestamp:new Date().toISOString()}))}catch(o){console.warn("Embedsy: Failed to save messages:",o)}},H=s=>{try{const t=`${w}_${s}`,o=localStorage.getItem(t);if(!o)return[];const a=JSON.parse(o),r=Date.now()-new Date(a.timestamp).getTime(),n=24*60*60*1e3;return r>n?(localStorage.removeItem(t),[]):a.messages||[]}catch(t){return console.warn("Embedsy: Failed to load messages:",t),[]}},P=s=>{const[t,o]=l.useState([]);return l.useEffect(()=>{if(s){const n=H(s);n.length>0?o(n):o([{id:`msg_${Date.now()}`,role:"bot",content:"ðŸ‘‹ Hi there! I'm your AI assistant. Ask me anything about our documentation and I'll help you find the answers!",timestamp:new Date().toISOString()}])}},[s]),l.useEffect(()=>{s&&t.length>0&&B(s,t)},[t,s]),{messages:t,addMessage:n=>{o(i=>[...i,{...n,id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:n.timestamp||new Date().toISOString()}])},clearAllMessages:()=>{o([{id:`msg_${Date.now()}`,role:"bot",content:"ðŸ‘‹ Hi there! I'm your AI assistant. Ask me anything about our documentation and I'll help you find the answers!",timestamp:new Date().toISOString()}])}}},W=async(s,t,o,a="en",r)=>{try{const n=await fetch(`${r}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:s,message:t,apiKey:o,targetLanguage:a})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to get response from server")}return await n.json()}catch(n){throw n.name==="TypeError"?new Error("No response from server. Please check your connection."):n}},J=(s,t,o,a,r)=>{const[n,i]=l.useState(!1),[c,m]=l.useState(null);return{send:async g=>{if(!(!g.trim()||n)){i(!0),m(null);try{const u=await W(s,g,t,o,r);return a&&a(u),u}catch(u){throw m(u.message),u}finally{i(!1)}}},isLoading:n,error:c,clearError:()=>m(null)}},K="https://embedsy-backend.onrender.com/api";function z({projectId:s,apiKey:t,title:o="Chat with us",position:a="bottom-right",themeColor:r="#00FF87",apiUrl:n=K}){const[i,c]=l.useState(!1),[m,x]=l.useState("en"),{messages:f,addMessage:g,clearAllMessages:u}=P(s);l.useEffect(()=>{const d=`embedsy-root-${s}`,h=document.getElementById(d)||document.getElementById("embedsy-widget-root");h&&h.style.setProperty("--embedsy-theme",r)},[r,s]);const v=d=>{g({role:"bot",content:d.answer,sources:d.sources,confidence:d.confidence})},{send:p,isLoading:S,error:N,clearError:j}=J(s,t,m,v,n),k=async d=>{g({role:"user",content:d}),j();try{await p(d)}catch(h){console.error("Embedsy: Failed to send message:",h)}},E=()=>{const d=[...f].reverse().find(h=>h.role==="user");d&&(j(),p(d.content))},M=d=>{x(d),u()};return e.jsx("div",{className:`embedsy-widget-container embedsy-position-${a}`,children:i?e.jsx(_,{messages:f,isLoading:S,error:N,onSend:k,onClose:()=>c(!1),onRetry:E,onClear:u,title:o,selectedLanguage:m,onLanguageChange:M}):e.jsx(C,{onClick:()=>c(!0)})})}exports.EmbedsynWidget=z;
